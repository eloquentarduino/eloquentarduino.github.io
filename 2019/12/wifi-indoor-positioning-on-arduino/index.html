<!DOCTYPE html>
<html lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" id="ao_optimized_gfonts" href="https://fonts.googleapis.com/css?family=Lato%3A400%2C700%2C400italic%2C700italic%7CLato:400,700&display=swap"><link media="all" href="https://eloquentarduino.github.io/wp-content/cache/autoptimize/css/autoptimize_531330376f8d2dbb05d1817ed8bdf0e5.css" rel="stylesheet"><title>Indoor positioning using Arduino and Machine Learning in 4 steps</title><meta name="robots" content="index, follow"><meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Indoor positioning using Arduino and Machine Learning in 4 steps"><meta property="og:description" content="In this Arduno Machine learning project we're going to use the nearby WiFi access points to locate where we are. For this project to work you will need a Wifi equipped board, such as ESP8266 or ESP32. Table of contentsWhat is indoor positioning?What will we use it for?What you needHow it worksFeatures definitionRecord sample dataEnumerate […]"><meta property="og:url" content="https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/"><meta property="og:site_name" content="Eloquent Arduino Blog"><meta property="article:published_time" content="2019-12-20T17:31:16+00:00"><meta property="article:modified_time" content="2020-01-25T16:16:52+00:00"><meta property="og:image" content="https://eloquentarduino.github.io/wp-content/uploads/2019/12/illustrations_ambient-wifi-site-survey2.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://eloquentarduino.github.io/wp-content/uploads/2019/12/illustrations_ambient-wifi-site-survey2.jpg"> <script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://eloquentarduino.github.io/#website","url":"https://eloquentarduino.github.io/","name":"Eloquent Arduino Blog","description":"Machine learning on Arduino, programming & electronics","publisher":{"@id":"https://eloquentarduino.github.io/#/schema/person/c35265597251f0133ecca5b413d12901"},"potentialAction":[{"@type":"SearchAction","target":"https://eloquentarduino.github.io/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/#primaryimage","inLanguage":"en-US","url":"https://eloquentarduino.github.io/wp-content/uploads/2019/12/illustrations_ambient-wifi-site-survey2.jpg","width":850,"height":505,"caption":"Wifi indoor positioning"},{"@type":"WebPage","@id":"https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/#webpage","url":"https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/","name":"Indoor positioning using Arduino and Machine Learning in 4 steps","isPartOf":{"@id":"https://eloquentarduino.github.io/#website"},"primaryImageOfPage":{"@id":"https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/#primaryimage"},"datePublished":"2019-12-20T17:31:16+00:00","dateModified":"2020-01-25T16:16:52+00:00","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/"]}]},{"@type":"Article","@id":"https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/#article","isPartOf":{"@id":"https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/#webpage"},"author":{"@id":"https://eloquentarduino.github.io/#/schema/person/c35265597251f0133ecca5b413d12901"},"headline":"Indoor positioning using Arduino and Machine Learning in 4 steps","datePublished":"2019-12-20T17:31:16+00:00","dateModified":"2020-01-25T16:16:52+00:00","commentCount":0,"mainEntityOfPage":{"@id":"https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/#webpage"},"publisher":{"@id":"https://eloquentarduino.github.io/#/schema/person/c35265597251f0133ecca5b413d12901"},"image":{"@id":"https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/#primaryimage"},"keywords":"microml","articleSection":"Arduino Machine learning","inLanguage":"en-US"},{"@type":["Person","Organization"],"@id":"https://eloquentarduino.github.io/#/schema/person/c35265597251f0133ecca5b413d12901","name":"simone","image":{"@type":"ImageObject","@id":"https://eloquentarduino.github.io/#personlogo","inLanguage":"en-US","url":"https://eloquentarduino.github.io/wp-content/uploads/2019/12/avatar.jpg","width":330,"height":330,"caption":"simone"},"logo":{"@id":"https://eloquentarduino.github.io/#personlogo"}}]}</script> <link rel="dns-prefetch" href="//use.fontawesome.com"><link rel="dns-prefetch" href="//s.w.org"><link href="https://fonts.gstatic.com" crossorigin="anonymous" rel="preconnect"><link rel="stylesheet" id="font-awesome-official-css" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css" type="text/css" media="all" integrity="sha384-REHJTs1r2ErKBuJB0fCK99gCYsVjwxHrSU0N7I1zl9vZbggVJXRMsv/sLlOAGb4M" crossorigin="anonymous"><link rel="stylesheet" id="font-awesome-official-v4shim-css" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css" type="text/css" media="all" integrity="sha384-AL44/7DEVqkvY9j8IjGLGZgFmHAjuHa+2RIWKxDliMNIfSs9g14/BRpYwHrWQgz6" crossorigin="anonymous"> <script type="text/javascript" src="https://eloquentarduino.github.io/wp-includes/js/jquery/jquery.js"></script> <meta name="google-site-verification" content="xgigjPrbbYDemskTaGLT9WGhmw8wgdeFtpDxVak0awI"></head><body class="post-template-default single single-post postid-224 single-format-standard"><div class="wrapper"><div class="sidebar"><div class="blog-header"> <a class="blog-logo" href="https://eloquentarduino.github.io" title="Eloquent Arduino Blog — Machine learning on Arduino, programming & electronics" rel="home"> <noscript><img src="https://eloquentarduino.github.io/wp-content/uploads/2019/12/logo-completo.png" alt="Eloquent Arduino Blog"></noscript><img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://eloquentarduino.github.io/wp-content/uploads/2019/12/logo-completo.png" alt="Eloquent Arduino Blog"> </a></div><div class="nav-toggle toggle"><p> <span class="show">Show menu</span> <span class="hide">Hide menu</span></p><div class="bars"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="clear"></div></div></div><div class="blog-menu"><ul class="navigation"><li id="menu-item-461" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-461"><a href="https://eloquentarduino.github.io/category/programming/arduino-machine-learning/">Arduino Machine learning</a></li><li id="menu-item-462" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-462"><a href="https://eloquentarduino.github.io/category/programming/eloquent-library/">Eloquent library</a></li></ul><div class="clear"></div></div><div class="mobile-menu"><ul class="navigation"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-461"><a href="https://eloquentarduino.github.io/category/programming/arduino-machine-learning/">Arduino Machine learning</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-462"><a href="https://eloquentarduino.github.io/category/programming/eloquent-library/">Eloquent library</a></li></ul></div><div class="widgets" role="complementary"><div class="widget_text widget widget_custom_html"><div class="widget_text widget-content"><div class="textwidget custom-html-widget"><div style="text-align: center"> <noscript><img src="/wp-content/uploads/2020/04/profilo.png" alt="Profile pic" style="width: 125px"></noscript><img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/04/profilo.png" alt="Profile pic" style="width: 125px"> <a href="/about-me" style="display: block; font-size: 18px">About me</a></div></div></div><div class="clear"></div></div><div class="widget widget_search"><div class="widget-content"><form method="get" class="searchform" action="https://eloquentarduino.github.io" id="searchform"><div role="search" class="searchbox__wrapper"> <input id="search-input" type="search" name="search" placeholder="Search the blog" autocomplete="off" required="required" class="searchbox__input"> <button type="submit" title="Submit your search query." class="searchbox__submit"> <svg role="img" aria-label="Search"> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#sbx-icon-search-13"></use> </svg> </button> <button type="reset" title="Clear the search query." class="searchbox__reset hide"> <svg role="img" aria-label="Reset"> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#sbx-icon-clear-3"></use> </svg> </button></div></form></div><div class="clear"></div></div><div class="widget widget_recent_entries"><div class="widget-content"><h3 class="widget-title">Recent Posts</h3><ul><li> <a href="https://eloquentarduino.github.io/2020/04/incremental-multiclass-classification-on-microcontrollers-one-vs-one/">Incremental multiclass classification on microcontrollers: One vs One</a></li><li> <a href="https://eloquentarduino.github.io/2020/04/stochastic-gradient-descent-on-your-microcontroller/">Stochastic Gradient Descent on your microcontroller</a></li><li> <a href="https://eloquentarduino.github.io/2020/04/passive-aggressive-classifier-for-embedded-devices/">Passive-aggressive classifier for embedded devices</a></li><li> <a href="https://eloquentarduino.github.io/2020/03/how-to-train-a-color-classification-machine-learning-classifier-directly-on-your-arduino-board/">How to train a color classification Machine learning classifier directly on your Arduino board</a></li><li> <a href="https://eloquentarduino.github.io/2020/03/how-to-train-a-iris-classification-machine-learning-classifier-directly-on-your-arduino-board/">How to train a IRIS classification Machine learning classifier directly on your Arduino board</a></li></ul></div><div class="clear"></div></div><div class="widget widget_sub_categories"><div class="widget-content"><h3 class="widget-title">Programming</h3><ul><li class="cat-item cat-item-8"><a href="https://eloquentarduino.github.io/category/programming/arduino-machine-learning/">Arduino Machine learning</a></li><li class="cat-item cat-item-12"><a href="https://eloquentarduino.github.io/category/programming/computer-vision/">Computer vision</a></li><li class="cat-item cat-item-7"><a href="https://eloquentarduino.github.io/category/programming/eloquent-library/">Eloquent library</a></li></ul></div><div class="clear"></div></div><div class="widget widget_tag_cloud"><div class="widget-content"><h3 class="widget-title">TAGS</h3><div class="tagcloud"><a href="https://eloquentarduino.github.io/tag/camera/" class="tag-cloud-link tag-link-11 tag-link-position-1" style="font-size: 12.375pt;" aria-label="camera (3 items)">camera</a> <a href="https://eloquentarduino.github.io/tag/eloquent/" class="tag-cloud-link tag-link-4 tag-link-position-2" style="font-size: 12.375pt;" aria-label="eloquent (3 items)">eloquent</a> <a href="https://eloquentarduino.github.io/tag/esp32/" class="tag-cloud-link tag-link-10 tag-link-position-3" style="font-size: 12.375pt;" aria-label="esp32 (3 items)">esp32</a> <a href="https://eloquentarduino.github.io/tag/incremental-learning/" class="tag-cloud-link tag-link-16 tag-link-position-4" style="font-size: 8pt;" aria-label="incremental-learning (1 item)">incremental-learning</a> <a href="https://eloquentarduino.github.io/tag/microml/" class="tag-cloud-link tag-link-5 tag-link-position-5" style="font-size: 22pt;" aria-label="microml (17 items)">microml</a> <a href="https://eloquentarduino.github.io/tag/ml/" class="tag-cloud-link tag-link-17 tag-link-position-6" style="font-size: 8pt;" aria-label="ml (1 item)">ml</a> <a href="https://eloquentarduino.github.io/tag/online-learning/" class="tag-cloud-link tag-link-15 tag-link-position-7" style="font-size: 10.625pt;" aria-label="online-learning (2 items)">online-learning</a> <a href="https://eloquentarduino.github.io/tag/rvm/" class="tag-cloud-link tag-link-13 tag-link-position-8" style="font-size: 8pt;" aria-label="rvm (1 item)">rvm</a> <a href="https://eloquentarduino.github.io/tag/svm/" class="tag-cloud-link tag-link-14 tag-link-position-9" style="font-size: 8pt;" aria-label="svm (1 item)">svm</a></div></div><div class="clear"></div></div></div></div><div class="content"><div class="posts"><div id="post-224" class="post-224 post type-post status-publish format-standard hentry category-arduino-machine-learning tag-microml"><div class="post-inner"><div class="post-header"><h1 class="post-title"><a href="https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/" rel="bookmark" title="Indoor positioning using Arduino and Machine Learning in 4 steps">Indoor positioning using Arduino and Machine Learning in 4 steps</a></h1><div class="post-meta"> <span class="post-date"><a href="https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/" title="Indoor positioning using Arduino and Machine Learning in 4 steps">20 December 2019</a></span> <span class="date-sep"> / </span> <span class="post-author"><a href="https://eloquentarduino.github.io/author/simone/" title="Posts by simone" rel="author">simone</a></span></div></div><div class="post-content"><div class="has-content-area" data-url="https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/" data-title="Indoor positioning using Arduino and Machine Learning in 4 steps"><p>In this Arduno Machine learning project we're going to use the nearby WiFi access points to locate where we are. For this project to work you will need a Wifi equipped board, such as ESP8266 or ESP32.</p><p><noscript><img src="https://eloquentarduino.github.io/wp-content/uploads/2019/12/illustrations_ambient-wifi-site-survey2.jpg" alt="Wifi indoor positioning @ ri-elaborated from https://www.accuware.com/blog/ambient-signals-plus-video-images/"></noscript><img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://eloquentarduino.github.io/wp-content/uploads/2019/12/illustrations_ambient-wifi-site-survey2.jpg" alt="Wifi indoor positioning @ ri-elaborated from https://www.accuware.com/blog/ambient-signals-plus-video-images/"></p><p><span id="more-224"></span></p><p></p><div class="toc"><h6>Table of contents</h6><ol><li><a href="#tocwhat-is-indoor-positioning">What is indoor positioning?</a><ol><li><a href="#tocwhat-will-we-use-it-for">What will we use it for?</a></li><li><a href="#tocwhat-you-need">What you need</a></li><li><a href="#tochow-it-works">How it works</a></li></ol></li><li><a href="#tocfeatures-definition">Features definition</a></li><li><a href="#tocrecord-sample-data">Record sample data</a><ol><li><a href="#tocenumerate-the-access-points">Enumerate the access points</a></li><li><a href="#toccreate-an-access-point-array">Create an access point array</a></li><li><a href="#tocconvert-to-features-vector">Convert to features vector</a></li></ol></li><li><a href="#toctrain-and-export-the-svm-classifier">Train and export the SVM classifier</a></li><li><a href="#tocrun-the-inference">Run the inference</a></li></ol></div><h2 id="tocwhat-is-indoor-positioning">What is indoor positioning?</h2><p>We all are used to GPS positioning: our device will use satellites to track our position on Earth. GPS works very well and with a very high accuracy (you can expect only a few meters of error).</p><p>But it suffers a problem: it needs <em>Line of Sight</em> (a clear path from your device to the satellites). If you're not in an open place, like inside a building, you're out of luck.</p><p>The task of detecting where you are when GPS localization is not an option is called <a href="https://en.wikipedia.org/wiki/Indoor_positioning_system">indoor positioning</a>: it could be in a building, an airport, a parking garage.</p><p>There are lots of different approaches to this task (Wikipedia lists more than 10 of them), each with a varying level of commitment, difficulty, cost and accuracy.</p><p>For this tutorial I opted for one that is both cost-efficient, easy to implement and readily available in most of the locations: <strong>WiFi indoor positioning</strong>.</p><h3 id="tocwhat-will-we-use-it-for">What will we use it for?</h3><p>In this tutorial about Machine learning on Arduino we're going to use Wifi indoor positioning to detect in which room of our house / office we are. This is the most basic task we can accomplish and will get us a feeling of level of accuracy we can achieve with such a simple setup.</p><p>On this basis, we'll construct more sophisticated projects in future posts.</p><h3 id="tocwhat-you-need">What you need</h3><p>To accomplish this tutorial, you really need 2 things:</p><ol><li>a WiFi equipped board (ESP8266, ESP32, Arduino MKR WiFi 1010...)</li><li>be in a place with a few WiFi networks around</li></ol><p>If you're doing this at home or in your office, there's a good change your neighbours have WiFi networks in their apartments you can leverage. If you live in an isolated contryside, sorry, this will not work for you.</p><h3 id="tochow-it-works">How it works</h3><p>So, how exactly does Wifi indoor positioning works in conjuction with Machine learning?</p><p>Let's pretend there are 5 different WiFi networks around you, like in the picture below.</p><p><noscript><img src="https://eloquentarduino.github.io/wp-content/uploads/2019/12/Wifi1.png" alt="Wifi indoor positioning example"></noscript><img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://eloquentarduino.github.io/wp-content/uploads/2019/12/Wifi1.png" alt="Wifi indoor positioning example"></p><p>As you can see there are two markers on the map: each of these markers will "see" different networks, with different <em>signal strengths</em> (a.k.a <a href="https://en.wikipedia.org/wiki/Received_signal_strength_indication">RSSI</a>).</p><p>As you move around, those numbers will change: each room will be identified by the unique combination of the RSSIs.</p><h2 id="tocfeatures-definition">1. Features definition</h2><p>The features for this project are going to be the RSSIs (Received signal strength indication) of the known WiFi networks. If a network is out of range, it will have an RSSI equal to 0.</p><h2 id="tocrecord-sample-data">2. Record sample data</h2><p>Before actually recording the sample data to train our classifier, we need to do some preliminary work. This is because not all networks will be visible all the time:  we have to work, however, with a fixed number of features.</p><h3 id="tocenumerate-the-access-points">2.1 Enumerate the access points</h3><p>First of all we need to enumerate all the networks we will encounter during the inference process.</p><p>To begin, we take a "reconnaissance tour" of the locations we want to predict and log all the networks we detect. Load the following sketch and take note of all the networks that appear on the Serial monitor.</p><pre><code class="language-cpp">#include <WiFi.h>

void setup() {
    Serial.begin(115200);
    WiFi.mode(WIFI_STA);
    WiFi.disconnect();
}

void loop() {
  int numNetworks = WiFi.scanNetworks();

  for (int i = 0; i < numNetworks; i++) {
      Serial.println(WiFi.SSID(i));

  delay(3000);
}</code></pre><h3 id="toccreate-an-access-point-array">2.2 Create an access point array</h3><p>Now that we have a bunch of SSIDs, we need to assign each SSID to a fixed index, from 0 to <code>MAX_NETWORKS</code>.</p><p>You can implement this part as you like, but in this demo I'll make use of a class I wrote called <code>Array</code> (you can see the <a href="https://github.com/eloquentarduino/EloquentArduino/blob/master/src/data_structures/Array.h">source code</a> and <a href="https://github.com/agrimagsrl/eloquentarduino/blob/master/examples/ArrayExample/ArrayExample.ino">example</a> on Github), which implements 2 useful functions:</p><ol><li><code>push()</code> to add an element to the array</li><li><code>indexOf()</code> to get the index of an element.</li></ol><p>See <a href="/2019/12/how-to-install-the-eloquent-library/">how to install the Eloquent library</a> if you don't have it already installed.<br> At this point we populate the array with all the networks we saved from the reconnaissance tour.</p><pre><code class="language-cpp">#include <eDataStructures.h>

#define MAX_NETWORKS 10

using namespace Eloquent::DataStructures;

double features[MAX_NETWORKS];
Array<String, MAX_NETWORKS> knownNetworks("");

void setup() {
    Serial.begin(115200);
    WiFi.mode(WIFI_STA);
    WiFi.disconnect();

    knownNetworks.push("SSID #0");
    knownNetworks.push("SSID #1");
    knownNetworks.push("SSID #2");
    knownNetworks.push("SSID #3");
    // and so on
}</code></pre><h3 id="tocconvert-to-features-vector">2.3 Convert to features vector</h3><p>The second step is to convert the scan results into a features vector. Each feature will be the RSSI of the given SSID, in the exact order we populated the <code>knownNetworks</code> array.</p><p>In practice:</p><pre><code class="language-cpp">features[0] == RSSI of SSID #0;
features[1] == RSSI of SSID #1;
features[2] == RSSI of SSID #2;
features[3] == RSSI of SSID #3;
// and so on</code></pre><p>The code below will do the job.</p><pre><code class="language-cpp">void loop() {
    scan();
    printFeatures();
    delay(3000);
}

void scan() {
    int numNetworks = WiFi.scanNetworks();

    resetFeatures();

    // assign RSSIs to feature vector
    for (int i = 0; i < numNetworks; i++) {
        String ssid = WiFi.SSID(i);
        uint16_t networkIndex = knownNetworks.indexOf(ssid);

        // only create feature if the current SSID is a known one
        if (!isnan(networkIndex))
            features[networkIndex] = WiFi.RSSI(i);
    }
}

// reset all features to 0
void resetFeatures() {
    const uint16_t numFeatures = sizeof(features) / sizeof(double);

    for (int i = 0; i < numFeatues; i++)
        features[i] = 0;
}</code></pre><pre><code class="language-cpp">
void printFeatures() {
    const uint16_t numFeatures = sizeof(features) / sizeof(double);
    
    for (int i = 0; i < numFeatures; i++) {
        Serial.print(features[i]);
        Serial.print(i == numFeatures - 1 ? 'n' : ',');
    }
}
</code></pre><p>Grab some recordings just staying in a location for a few seconds and save the serial output to a file; then move to the next location and repeat: 10-15 samples for each location will suffice.</p><p>If you do a good job, you should end with distinguible features, as show in the plot below.</p><p><noscript><img src="https://eloquentarduino.github.io/wp-content/uploads/2019/12/Decision-boundaries-of-2-PCA-components-from-Wifi-indoor-positioning-features.png" alt="Decision boundaries of 2 PCA components from Wifi indoor positioning features"></noscript><img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://eloquentarduino.github.io/wp-content/uploads/2019/12/Decision-boundaries-of-2-PCA-components-from-Wifi-indoor-positioning-features.png" alt="Decision boundaries of 2 PCA components from Wifi indoor positioning features"></p><div class="watchout"> RSSIs may be a little noisy, mostly on the boundaries where weak networks may appear and disappear with a very low RSSI: this was not a problem for me, but if you're getting bad results you may filter out those low values.<pre><code class="language-cpp">
// replace
features[networkIndex] = WiFi.RSSI(i);

// with
#define MIN_RSSI -90 // adjust to your needs

features[networkIndex] = WiFi.RSSI(i) > MIN_RSSI ? WiFi.RSSI(i) : 0;
</code></pre></div><h2 id="toctrain-and-export-the-svm-classifier">3. Train and export the SVM classifier</h2><p>For a detailed guide refer to the <a href="/2019/11/how-to-train-a-classifier-in-scikit-learn/" target="_blank" rel="noopener noreferrer">tutorial</a></p><p></p><pre><code class="language-python">from sklearn.svm import SVC
from micromlgen import port

# put your samples in the dataset folder
# one class per file
# one feature vector per line, in CSV format
features, classmap = load_features('dataset/')
X, y = features[:, :-1], features[:, -1]
classifier = SVC(kernel='linear').fit(X, y)
c_code = port(classifier, classmap=classmap)
print(c_code)</code></pre><p>At this point you have to copy the printed code and import it in your Arduino project, in a file called <code>model.h</code>.</p><h2 id="tocrun-the-inference">4. Run the inference</h2><pre><code class="language-cpp">#include "model.h"

void loop() {
    scan();
    classify();
    delay(3000);
}

void classify() {
    Serial.print("You are in ");
    Serial.println(classIdxToName(predict(features)));
}</code></pre><p>Move around your house/office/whatever and see your location printed on the serial monitor!</p><p><br></p><p>Did you find this tutorial useful? Was is it easy to follow or did I miss something? Let me know in the comments so I can keep improving the blog.</p><br><hr><p>Check the full project code on <a href="https://github.com/eloquentarduino/EloquentArduino/blob/master/examples/MicromlWifiIndoorPositioningExample/MicromlWifiIndoorPositioningExample.ino" target="_blank" rel="noopener noreferrer">Github</a></p></div><div class="heateorSssClear"></div><div class="heateor_sss_sharing_container heateor_sss_horizontal_sharing" heateor-sss-data-href="https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/"><div class="heateor_sss_sharing_title" style="font-weight:bold">Help the blow grow</div><ul class="heateor_sss_sharing_ul"><li class="heateorSssSharingRound"><i style="width:35px;height:35px;border-radius:999px;" alt="Facebook" title="Facebook" class="heateorSssSharing heateorSssFacebookBackground" onclick='heateorSssPopup("https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Feloquent.blog%2F2019%2F12%2Fwifi-indoor-positioning-on-arduino%2F")'><ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssFacebookSvg"></ss></i></li><li class="heateorSssSharingRound"><i style="width:35px;height:35px;border-radius:999px;" alt="Twitter" title="Twitter" class="heateorSssSharing heateorSssTwitterBackground" onclick='heateorSssPopup("http://twitter.com/intent/tweet?via=ArduinoEloquent&text=Indoor%20positioning%20using%20Arduino%20and%20Machine%20Learning%20in%204%20steps&url=http%3A%2F%2Feloquent.blog%2F2019%2F12%2Fwifi-indoor-positioning-on-arduino%2F")'><ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssTwitterSvg"></ss></i></li><li class="heateorSssSharingRound"><i style="width:35px;height:35px;border-radius:999px;" alt="Linkedin" title="Linkedin" class="heateorSssSharing heateorSssLinkedinBackground" onclick='heateorSssPopup("http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Feloquent.blog%2F2019%2F12%2Fwifi-indoor-positioning-on-arduino%2F&title=Indoor%20positioning%20using%20Arduino%20and%20Machine%20Learning%20in%204%20steps")'><ss style="display:block;border-radius:999px;" class="heateorSssSharingSvg heateorSssLinkedinSvg"></ss></i></li><li class="heateorSssSharingRound"><i style="width:35px;height:35px;border-radius:999px;" title="More" alt="More" class="heateorSssSharing heateorSssMoreBackground" onclick="heateorSssMoreSharingPopup(this, 'https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/', 'Indoor%20positioning%20using%20Arduino%20and%20Machine%20Learning%20in%204%20steps', '' )"><ss style="display:block" class="heateorSssSharingSvg heateorSssMoreSvg"></ss></i></li></ul><div class="heateorSssClear"></div></div><div class="heateorSssClear"></div><div class="heateor_sss_sharing_container heateor_sss_vertical_sharing heateor_sss_bottom_sharing" style="width:44px;right: -10px;top: 100px;-webkit-box-shadow:none;box-shadow:none;" heateor-sss-data-href="https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/"><ul class="heateor_sss_sharing_ul"><li class=""><i style="width:40px;height:40px;margin:0;" alt="Facebook" title="Facebook" class="heateorSssSharing heateorSssFacebookBackground" onclick='heateorSssPopup("https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Feloquent.blog%2F2019%2F12%2Fwifi-indoor-positioning-on-arduino%2F")'><ss style="display:block;" class="heateorSssSharingSvg heateorSssFacebookSvg"></ss></i></li><li class=""><i style="width:40px;height:40px;margin:0;" alt="Twitter" title="Twitter" class="heateorSssSharing heateorSssTwitterBackground" onclick='heateorSssPopup("http://twitter.com/intent/tweet?via=ArduinoEloquent&text=Indoor%20positioning%20using%20Arduino%20and%20Machine%20Learning%20in%204%20steps&url=http%3A%2F%2Feloquent.blog%2F2019%2F12%2Fwifi-indoor-positioning-on-arduino%2F")'><ss style="display:block;" class="heateorSssSharingSvg heateorSssTwitterSvg"></ss></i></li><li class=""><i style="width:40px;height:40px;margin:0;" title="More" alt="More" class="heateorSssSharing heateorSssMoreBackground" onclick="heateorSssMoreSharingPopup(this, 'https://eloquentarduino.github.io/2019/12/wifi-indoor-positioning-on-arduino/', 'Indoor%20positioning%20using%20Arduino%20and%20Machine%20Learning%20in%204%20steps', '' )"><ss style="display:block" class="heateorSssSharingSvg heateorSssMoreSvg"></ss></i></li></ul><div class="heateorSssClear"></div></div><div class="crp_related  "><h3>Related Posts</h3><ul><li><a href="https://eloquentarduino.github.io/2020/01/image-recognition-with-esp32-and-arduino/" class="post-820"><span class="crp_title">Apple or Orange? Image recognition with ESP32 and Arduino</span></a></li><li><a href="https://eloquentarduino.github.io/2020/01/easy-tinyml-on-esp32-and-arduino/" class="post-864"><span class="crp_title">Easy TinyML on ESP32 and Arduino</span></a></li><li><a href="https://eloquentarduino.github.io/2020/03/so-you-want-to-train-an-ml-classifier-directly-on-an-arduino-board/" class="post-982"><span class="crp_title">So you want to train an ML classifier directly on an Arduino board?</span></a></li><li><a href="https://eloquentarduino.github.io/2019/12/how-to-do-gesture-identification-on-arduino/" class="post-35"><span class="crp_title">How to do Gesture identification through machine learning on Arduino</span></a></li></ul><div class="crp_clear"></div></div><div id="disqus_thread"></div></div><div class="clear"></div></div></div></div><div class="post-meta-bottom"><div class="post-cat-tags"><p class="post-categories"><span>Categories:</span> <a href="https://eloquentarduino.github.io/category/programming/arduino-machine-learning/" rel="category tag">Arduino Machine learning</a></p><p class="post-tags">Tags: <a href="https://eloquentarduino.github.io/tag/microml/" rel="tag">microml</a></p></div><div class="archive-nav post-nav"> <a class="post-nav-older" title="Previous post: How to do Gesture identification through machine learning on Arduino" href="https://eloquentarduino.github.io/2019/12/how-to-do-gesture-identification-on-arduino/"> « How to do Gesture identification through machine learning on Arduino </a> <a class="post-nav-newer" title="Next post: Word classification using Arduino and MicroML" href="https://eloquentarduino.github.io/2019/12/word-classification-using-arduino/"> Word classification using Arduino and MicroML » </a><div class="clear"></div></div></div><p class="nocomments">Comments are closed.</p><div class="footer section large-padding bg-dark"><div class="clear"></div></div><div class="credits"><div class="credits-inner"><p class="credits-left">© 2020 <a href="https://eloquentarduino.github.io" title="Eloquent Arduino Blog">Eloquent Arduino Blog</a></p><p class="credits-right"><span>Theme by <a href="https://www.andersnoren.se">Anders Norén</a></span> — <a title="To the top" class="tothetop">Up ↑</a></p><div class="clear"></div></div></div></div><div class="clear"></div></div> <script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script> <script src="//cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154550080-1"></script> <script>if (window.location.href.indexOf("eloquent.blog") < 0) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154550080-1');
}</script>  <script>(function() {
setTimeout(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://eloquent-arduino.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);},
10000);
})();</script>  <noscript><style>.lazyload{display:none;}</style></noscript><script data-noptimize="1">window.lazySizesConfig=window.lazySizesConfig||{};window.lazySizesConfig.loadMode=1;</script><script async data-noptimize="1" src="https://eloquentarduino.github.io/wp-content/plugins/autoptimize/classes/external/js/lazysizes.min.js"></script><link rel="stylesheet" id="fontawesome5-css" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" type="text/css" media="all"> <script type="text/javascript">function heateorSssLoadEvent(e) {var t=window.onload;if (typeof window.onload!="function") {window.onload=e}else{window.onload=function() {t();e()}}};	var heateorSssSharingAjaxUrl = 'https://eloquentarduino.github.io/wp-admin/admin-ajax.php', heateorSssCloseIconPath = 'https://eloquentarduino.github.io/wp-content/plugins/sassy-social-share/public/../images/close.png', heateorSssPluginIconPath = 'https://eloquentarduino.github.io/wp-content/plugins/sassy-social-share/public/../images/logo.png', heateorSssHorizontalSharingCountEnable = 0, heateorSssVerticalSharingCountEnable = 0, heateorSssSharingOffset = -10; var heateorSssMobileStickySharingEnabled = 1;var heateorSssCopyLinkMessage = "Link copied.";var heateorSssUrlCountFetched = [], heateorSssSharesText = 'Shares', heateorSssShareText = 'Share';function heateorSssPopup(e) {window.open(e,"popUpWindow","height=400,width=600,left=400,top=100,resizable,scrollbars,toolbar=0,personalbar=0,menubar=no,location=no,directories=no,status")};var heateorSssWhatsappShareAPI = "web";</script> <script type="text/javascript" src="https://eloquentarduino.github.io/wp-includes/js/dist/vendor/wp-polyfill.min.js"></script> <script type="text/javascript">( 'fetch' in window ) || document.write( '<script src="https://eloquentarduino.github.io/wp-includes/js/dist/vendor/wp-polyfill-fetch.min.js?ver=3.0.0">' + 'ipt>' );( document.contains ) || document.write( '<script src="https://eloquentarduino.github.io/wp-includes/js/dist/vendor/wp-polyfill-node-contains.min.js?ver=3.26.0-0">' + 'ipt>' );( window.FormData && window.FormData.prototype.keys ) || document.write( '<script src="https://eloquentarduino.github.io/wp-includes/js/dist/vendor/wp-polyfill-formdata.min.js?ver=3.0.12">' + 'ipt>' );( Element.prototype.matches && Element.prototype.closest ) || document.write( '<script src="https://eloquentarduino.github.io/wp-includes/js/dist/vendor/wp-polyfill-element-closest.min.js?ver=2.0.2">' + 'ipt>' );</script> <script type="text/javascript" src="https://eloquentarduino.github.io/wp-includes/js/dist/i18n.min.js"></script> <script type="text/javascript">var highlight_and_share = {"show_facebook":"1","show_twitter":"1","show_linkedin":"1","show_pinterest":"","show_email":"","show_xing":"","show_copy":"","show_whatsapp":"","twitter_username":"EloquentArduino","twitter_fa_class":"fa fa-twitter","facebook_fa_class":"fa fa-facebook","linkedin_fa_class":"fa fa-linkedin","pinterest_fa_class":"fa fa-pinterest","xing_fa_class":"fa fa-xing","whatsapp_fa_class":"fa fa-whatsapp","copy_fa_class":"fa fa-copy","email_fa_class":"fa fa-envelope","mobile":"","content":".has-content-area","tweet_text":"Tweet","facebook_text":"Share","linkedin_text":"LinkedIn","pinterest_text":"Pinterest","whatsapp_text":"WhatsApp","xing_text":"Xing","copy_text":"Copy","email_text":"E-mail","icons":"1","facebook_app_id":"2530754057166153","email_your_name_value":"","email_from_value":"","nonce":"45538ddec1","ajax_url":"https:\/\/eloquentarduino.github.io\/wp-admin\/admin-ajax.php","email_share":"Share This Post Via Email","email_subject":"Your Subject","email_your_name":"Your Name","email_send_email":"Send to Email Address","email_subject_text":"[Shared Post] %title%","email_from":"Your Email Address","email_send":"Send Email","email_cancel":"Cancel","email_close":"Close","email_loading":"https:\/\/eloquentarduino.github.io\/wp-content\/plugins\/highlight-and-share\/img\/loading.gif","email_subject_error":"You must fill in a subject.","email_email_to":"Send to Email Address is blank.","email_email_from":"Your email address is blank.","email_email_name":"Your name is blank.","email_sending":"Sending...","customizer_preview":""};</script> <script type="text/javascript">( function( domain, translations ) {
	var localeData = translations.locale_data[ domain ] || translations.locale_data.messages;
	localeData[""].domain = domain;
	wp.i18n.setLocaleData( localeData, domain );
} )( "highlight-and-share", { "locale_data": { "messages": { "": {} } } } );</script> <script defer src="https://eloquentarduino.github.io/wp-content/cache/autoptimize/js/autoptimize_f062da2440d4643f52bc756695d9db14.js"></script><script data-cfasync="false">!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){function e(){t.media=a}var a=t.media||"all";t.addEventListener?t.addEventListener("load",e):t.attachEvent&&t.attachEvent("onload",e),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(e,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);</script></body></html>
